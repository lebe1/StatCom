---
title: "Case Study 2" 
subtitle: "Group 97 - Data manipulation" 
author:
  - Beccard\, Leon - 12133103
  - Farmohammadi\, Pouya - 52116495
  - Monteiro Oliveira\, Guilherme - 12243299
date: "`r Sys.Date()`" 
output: 
  html_document: 
    toc: TRUE
    toc_float: 
      collapsed: TRUE 
      smooth_scroll: TRUE 
    toc_depth: 2 
    theme: readable 
    #number_sections: True
editor_options: 
  markdown: 
    wrap: 80
---

--------------------------------------------------------------------------------

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)

```

# Task

## Task a

We are loading the data that was available in TUWEL and we should keep the
contry names and the variables.

```{r a_Load_Data, }

#Get current directory

df_median <- read_fwf("./rawdata_343.txt", 
                      skip = 2, 
                      fwf_widths(c(8, 66, 12, NA), 
                                 c("Id", "Country", "Median age", "Note"))) %>% 
  select(Country, `Median age`)
  

df_net <- read_fwf("./rawdata_347.txt", 
                   skip = 2, 
                   fwf_widths(c(8, 64, 6, NA), 
                              c("Id", "Country", "Net migration rate", "Note"))) %>%
  select(Country, `Net migration rate`)

df_uempl <- read_csv("./rawdata_373.csv") %>% 
  rename("Country" = country_name, 
         "youth unemployed rate" = youth_unempl_rate)

```

## Task b

The following code is merging the datasets using the key *Country*.

```{r merge}

df <- df_median %>% 
  full_join(df_net, by = "Country") %>% 
  full_join(df_uempl, by = "Country")


```

## Task c

Acquiring data from the link
<https://datahelpdesk.worldbank.org/knowledgebase/articles/906519>

```{r acquire_data}

url <- "https://datacatalogfiles.worldbank.org/ddh-published/0037712/DR0090755/CLASS.xlsx"
destfile <- "CLASS.xlsx"

download.file(url, destfile)

df_country_group <- read_xlsx('./CLASS.xlsx', sheet = 1)


```

## Task d

1.  Common variable

```{r}

check1 <- df %>% left_join(df_country_group, by = c("Country" = "Economy"))

check1["Income group"] %>% is.na() %>% sum()

```

Here the common variable is Country and Economy. It is possible to merge them,
from the 227 countries 41 were not found.

2.  ISO Codes

The data was manually downloaded using the link
<https://www.cia.gov/the-world-factbook/references/country-data-codes/>

```{r}
codes <- read_csv("./Country\ Data\ Codes.csv")

```

3.  Reliable Merge

```{r}

reliable_merge <- df %>% 
  left_join(codes, by = c("Country" = "Name")) %>%
  left_join(df_country_group, by = c("GENC" = "Code"))

reliable_merge %>% select(Country, GENC, "Median age", "Net migration rate", 
                          "youth unemployed rate", "Income group")

reliable_merge["Income group"] %>% is.na() %>% sum()


```

Using this approach we got 15 missing values. What is corresponding to finding
more 26 countries.

## Task e

To add the regions to our dataset the data was obtained from
<https://statisticstimes.com/geography/countries-by-continents.php>.

```{r regions}

regions <- read_csv("./country_region_continent.csv")

df_vars <- reliable_merge %>% 
  left_join(regions, by = c(GENC = "ISO-alpha3 Code")) %>%
  select(Country, "Median age", "Net migration rate", "youth unemployed rate", 
         "Income group", "Region 1", "Continent")

```
